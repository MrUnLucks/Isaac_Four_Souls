<!DOCTYPE html>
<html>

<head>
    <title>Isaac Four Souls Game Client</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        .controls {
            margin: 10px 0;
        }

        .controls button {
            margin: 5px;
            padding: 10px;
        }

        .messages {
            border: 1px solid #ccc;
            height: 400px;
            overflow-y: scroll;
            padding: 10px;
            background: #f9f9f9;
        }

        .message {
            margin: 5px 0;
        }

        .sent {
            color: green;
        }

        .received {
            color: blue;
        }

        .error {
            color: red;
        }

        .system {
            color: gray;
        }

        input[type="text"] {
            width: 300px;
            padding: 5px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>üéÆ Isaac Four Souls WebSocket Client</h1>

        <div class="controls">
            <span id="status">Disconnected</span>
            <br>
            <label for="playerNameInput">Player Name</label>
            <input type="text" id="playerNameInput" placeholder="Player Name" value="TestPlayer">
            <br>
            <label for="roomNameInput">Room Name</label>
            <input type="text" id="roomNameInput" placeholder="Room name" value="Prova">
            <br>
            <button onclick="joinGame()">Join Room</button>
            <button onclick="leaveGame()">Leave Room</button>
            <button onclick="ready()">Ready!</button>
        </div>

        <div class="controls">
            <h3>Game Actions:</h3>
            <input type="text" id="chatInput" placeholder="Chat message">
            <button onclick="sendChat()">Send Chat</button>
            <button onclick="sendPing()">Send Ping</button>
        </div>

        <div class="controls">
            <h3>Raw JSON:</h3>
            <input type="text" id="rawJsonInput" placeholder='{"Ping": null}' style="width: 400px;">
            <button onclick="sendRawJson()">Send Raw JSON</button>
        </div>

        <h3>Messages:</h3>
        <div class="messages" id="messages"></div>
    </div>

    <script>
        let ws = null;
        let currentPlayerId = null;

        function connect() {
            ws = new WebSocket('ws://localhost:8080');

            ws.onopen = function () {
                addMessage('‚úÖ Connected to Isaac Four Souls server!', 'system');
                document.getElementById('status').textContent = 'Connected';
            };

            ws.onmessage = function (event) {
                console.log('Received:', event.data);

                try {
                    const response = JSON.parse(event.data);
                    handleServerResponse(response);
                } catch (e) {
                    addMessage('üì® Raw message: ' + event.data, 'received');
                }
            };

            ws.onclose = function () {
                addMessage('‚ùå Disconnected from server', 'system');
                document.getElementById('status').textContent = 'Disconnected';
                currentPlayerId = null;
            };

            ws.onerror = function (error) {
                addMessage('üí• WebSocket error: ' + JSON.parse(error), 'error');
            };
        }
        connect()

        function handleServerResponse(response) {
            console.log(response)
            if (response.Welcome) {
                currentPlayerId = response.Welcome.player_id;
                addMessage(`üéâ Welcome! Your Player ID: ${currentPlayerId}`, 'system');
            } else if (response.PlayerJoined) {
                addMessage(`üëã ${response.PlayerJoined.player_name} joined the game`, 'system');
            } else if (response.PlayerLeft) {
                addMessage(`üëã ${response.PlayerLeft.player_name} left the game`, 'system');
            } else if (response.ChatMessage) {
                addMessage(`üí¨ ${response.ChatMessage.player_name}: ${response.ChatMessage.message}`, 'received');
            } else if (response == "Pong") {
                addMessage(`üèì Pong received`);
            } else if (response.Error) {
                addMessage(`‚ùå Error: ${response.Error.message}`, 'error');
            } else {
                addMessage(`üì® Unknown response: ${JSON.stringify(response)}`, 'received');
            }
        }

        function joinGame() {
            const playerName = document.getElementById('playerNameInput').value;
            if (!playerName) {
                alert('Please enter a player name');
                return;
            }
            const roomName = document.getElementById('roomNameInput').value;
            if (!roomName) {
                alert('Please enter a game name');
                return;
            }

            const message = {
                "JoinRoom": {
                    "player_name": playerName,
                    "room_name": roomName
                }
            };

            sendJsonMessage(message);
        }

        function ready() {
            const message = {
                "Ready": {
                    "player_id": currentPlayerId,
                }
            };
        }

        function sendChat() {
            const chatText = document.getElementById('chatInput').value;
            if (!chatText || !currentPlayerId) {
                alert('Please join the game first and enter a message');
                return;
            }

            const message = {
                "Chat": {
                    "player_id": currentPlayerId,
                    "message": chatText
                }
            };

            sendJsonMessage(message);
            document.getElementById('chatInput').value = '';
        }

        function sendPing() {
            const message = "Ping";
            sendJsonMessage(message);
        }

        function leaveGame() {
            if (!currentPlayerId) {
                alert('You are not in a game');
                return;
            }

            const message = {
                "Leave": {
                    "player_id": currentPlayerId
                }
            };

            sendJsonMessage(message);
            currentPlayerId = null;
        }

        function sendRawJson() {
            const rawJson = document.getElementById('rawJsonInput').value;
            if (!rawJson) return;

            try {
                const parsed = JSON.parse(rawJson);
                sendJsonMessage(parsed);
                document.getElementById('rawJsonInput').value = '';
            } catch (e) {
                addMessage(`‚ùå Invalid JSON: ${e.message}`, 'error');
            }
        }

        function sendJsonMessage(messageObj) {
            if (!ws || ws.readyState !== WebSocket.OPEN) {
                addMessage('‚ùå Not connected to server', 'error');
                return;
            }

            const jsonString = JSON.stringify(messageObj);
            addMessage(`üì§ Sending: ${jsonString}`, 'sent');
            ws.send(jsonString);
        }

        function addMessage(message, type) {
            const messagesDiv = document.getElementById('messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        // Example messages for testing
        function loadExampleMessages() {
            document.getElementById('rawJsonInput').value = '{"Ping": null}';
        }

        // Load examples on page load
        window.onload = loadExampleMessages;
    </script>
</body>

</html>